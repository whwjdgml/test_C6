# 📋 통합 배터리 히터 시스템 명령어 레퍼런스

## 🔧 **시스템 제어 명령어**

| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `mode` | 시스템 모드 전환 | `mode <heater\|tx\|rx>` | `mode tx` |
| `info` | 현재 모드 및 상태 정보 | `info` | - |
| `help` | 전체 명령어 도움말 | `help` | - |

### 모드 설명:
- **heater**: 히터 전용 (ESP-NOW 없음, 최소 전력)
- **tx**: 송신기 (히터 + 데이터 전송)
- **rx**: 수신기 (데이터 수신 + 원격 제어)

---

## 🔥 **히터 제어 명령어** (heater/tx 모드)

### 테스트 제어:
| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `start` | 연속 테스트 시작 | `start [분]` | `start 120` (2시간) |
| `stop` | 테스트 중지 | `stop` | - |
| `status` | 현재 히터 상태 출력 | `status` | - |

### 파라미터 튜닝:
| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `tune` | 히터 파라미터 조정 | `tune <설정>=<값>` | `tune kp=15` |

#### tune 세부 옵션:
```bash
tune kp=값          # 비례 게인 (1.0~50.0)
tune target=값      # 목표 온도 (-10~20°C)  
tune dead=값        # 데드존 (0~2°C)
tune max=값         # 최대 듀티 (10~100%)
tune enable         # 비례 제어 활성화
tune disable        # 비례 제어 비활성화
tune params         # 현재 파라미터 출력
tune stats          # 성능 통계 출력
tune reset          # 통계 초기화
```

---

## 📊 **데이터 분석 명령어** (모든 모드)

| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `log` | 최근 측정 데이터 출력 | `log [개수]` | `log 20` |
| `csv` | CSV 형태로 전체 데이터 출력 | `csv` | `csv > data.csv` |

### CSV 출력 형식:
```
Time(s),Temperature(C),PWM_Duty(%),Error(C),StepUp
0,4.85,25,-0.15,ON
10,4.92,20,-0.08,ON
...
```

---

## 📡 **송신기 모드 명령어** (tx 모드 전용)

| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `interval` | 데이터 전송 간격 설정 | `interval <초>` | `interval 60` |
| `sendnow` | 즉시 데이터 전송 | `sendnow` | - |
| `comm` | ESP-NOW 통신 통계 출력 | `comm` | - |

### 전송 간격 권장값:
- **5초**: 개발/테스트용 (배터리 소모 많음)
- **30초**: 실시간 모니터링용
- **60초**: 일반 운영용 (권장)
- **300초**: 절전 운영용

---

## 📺 **수신기 모드 명령어** (rx 모드 전용)

### 모니터링:
| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `monitor` | 실시간 모니터링 시작 | `monitor` | - |
| `status` | 원격 히터 상태 출력 | `status` | - |
| `comm` | 수신 통계 출력 | `comm` | - |

### 원격 제어:
| 명령어 | 설명 | 사용법 | 예시 |
|-------|------|--------|------|
| `send` | 원격 제어 명령 전송 | `send <명령> <값>` | `send target 6.0` |

#### send 명령어 옵션:
```bash
send target 값      # 목표온도 변경 (예: send target 6.0)
send kp 값          # 비례게인 변경 (예: send kp 20)
send enable 1       # 히터 활성화
send enable 0       # 히터 비활성화
```

---

## 🎯 **실제 사용 시나리오별 명령어**

### **시나리오 1: 현장 단독 테스트**
```bash
# 1. 모드 설정
> mode heater

# 2. 파라미터 설정  
> tune target=5
> tune kp=15

# 3. 테스트 실행
> start 60

# 4. 중간 확인 (다른 터미널)
> status
> log 10

# 5. 결과 분석
> tune stats
> csv > test_results.csv
```

### **시나리오 2: 원격 모니터링 설정**

**현장 송신기:**
```bash
# 1. 송신기 모드 설정
> mode tx

# 2. 전송 설정
> interval 30        # 30초마다 전송

# 3. 장기 운영 시작  
> start 1440         # 24시간

# 4. 통신 상태 확인
> comm
```

**실내 수신기:**
```bash  
# 1. 수신기 모드 설정
> mode rx

# 2. 실시간 모니터링
> monitor
🌡️ 4.8°C → 35% PWM (목표: 5.0°C) [ON]

# 3. 원격 제어 (필요시)
> send target 7.0    # 목표온도 변경
> send kp 25         # 게인 조정

# 4. 상태 확인
> status
> comm
```

### **시나리오 3: 파라미터 최적화**
```bash
# 1. 기본 설정으로 시작
> mode heater
> tune kp=10
> start 30

# 2. 결과 확인
> tune stats
# 평균 오차: 1.5°C (높음)

# 3. 게인 증가
> tune kp=20  
> start 30

# 4. 성능 비교
> tune stats  
# 평균 오차: 0.8°C (개선됨)

# 5. 최적값 찾기
> tune kp=15
> start 30
> tune stats
# 평균 오차: 0.6°C (최적!)
```

---

## ⚡ **빠른 참조 (자주 사용하는 명령어)**

### 모드 전환:
```bash
> mode heater        # 히터 전용
> mode tx            # 송신기  
> mode rx            # 수신기
```

### 기본 설정:
```bash
> tune target=5      # 목표온도 5°C
> tune kp=15         # 게인 15
> interval 60        # 1분마다 전송 (송신기)
```

### 테스트 실행:
```bash
> start 60           # 1시간 테스트
> status             # 상태 확인
> log 10             # 최근 10개 데이터
```

### 원격 제어:
```bash
> monitor            # 실시간 모니터링 (수신기)
> send target 6.0    # 원격 목표온도 변경
> sendnow            # 즉시 데이터 전송 (송신기)
```

### 데이터 분석:
```bash
> csv > data.csv     # 데이터 내보내기
> tune stats         # 성능 통계
> comm               # 통신 통계
```

---

## 🚨 **문제 해결 명령어**

### 히터 문제:
```bash
> tune disable       # 히스테리시스 모드로 전환
> tune enable        # 비례제어 모드로 복원
> tune reset         # 통계 초기화
```

### 통신 문제:
```bash
> comm               # 통신 통계 확인
> sendnow            # 즉시 전송 테스트 (송신기)
> info               # 현재 모드 확인
```

### 성능 문제:
```bash
> tune kp=15         # 기본값으로 복원
> tune target=5      # 기본 목표온도
> tune stats         # 성능 확인
```

---

## 💡 **팁 & 트릭**

1. **명령어 조합**: `status && tune stats` (상태 + 통계)
2. **데이터 저장**: `csv > $(date +%Y%m%d_%H%M).csv`  
3. **실시간 튜닝**: monitor 중 다른 터미널에서 send 명령
4. **배치 설정**: `tune kp=15 && tune target=5 && start 60`

이제 **하나의 빌드로 모든 상황에 완벽 대응**할 수 있습니다! 🎉